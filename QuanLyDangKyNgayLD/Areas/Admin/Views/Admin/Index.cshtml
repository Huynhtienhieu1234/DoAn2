@model QuanLyDangKyNgayLD.Areas.Admin.Models.AdminThongKeViewModel

@{
    ViewBag.Title = "Trang Chủ Admin";
    Layout = "~/Areas/Admin/Views/Shared/ViewShare.cshtml";
}
<div class="dashboard-container">
    <!-- Các ô vuông thống kê -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card shadow h-100 text-center p-3 animate-card">
                <h6 class="text-muted">Tài khoản</h6>
                <h2 class="display-4 text-primary" data-target="@Model.TongTaiKhoan">0</h2>
                <a href="/Admin/TaiKhoan/ChiTiet" class="btn btn-sm btn-outline-primary mt-2">Xem chi tiết</a>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card shadow h-100 text-center p-3 animate-card">
                <h6 class="text-muted">Sinh viên</h6>
                <h2 class="display-4 text-success" data-target="@Model.TongSinhVien">0</h2>
                <a href="/Admin/SinhVien/ChiTiet" class="btn btn-sm btn-outline-success mt-2">Xem chi tiết</a>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card shadow h-100 text-center p-3 animate-card">
                <h6 class="text-muted">Đợt lao động</h6>
                <h2 class="display-4 text-warning" data-target="@Model.TongDotLaoDong">0</h2>
                <a href="/Admin/DotLaoDong/ChiTiet" class="btn btn-sm btn-outline-warning mt-2">Xem chi tiết</a>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card shadow h-100 text-center p-3 animate-card">
                <h6 class="text-muted">Hoàn thành</h6>
                <h2 class="display-4 text-info" data-target="@Model.TongHoanThanh">0</h2>
                <a href="/Admin/HoanThanh/ChiTiet" class="btn btn-sm btn-outline-info mt-2">Xem chi tiết</a>
            </div>
        </div>
    </div>

    <!-- Biểu đồ cột (làm nhỏ lại bằng cách thêm class CSS) -->
    <div class="row">
        <div class="col-md-8 mx-auto">
            <!-- Giới hạn chiều rộng để nhỏ lại -->
            <div class="card shadow p-3">
                <h5 class="text-center mb-3">Biểu đồ cột thống kê</h5>
                <div class="chart-container">
                    <!-- Wrapper để kiểm soát chiều cao -->
                    <canvas id="barChart" height="200"></canvas> <!-- Đặt chiều cao nhỏ hơn -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Gọi Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const data = {
        labels: ['Tài khoản', 'Sinh viên', 'Đợt lao động', 'Hoàn thành'],
        values: [
            @Model.TongTaiKhoan,
            @Model.TongSinhVien,
            @Model.TongDotLaoDong,
            @Model.TongHoanThanh
        ]
    };

    // Animation đếm số cho các ô vuông
    function animateNumbers() {
        const elements = document.querySelectorAll('[data-target]');
        elements.forEach(el => {
            const target = parseInt(el.getAttribute('data-target'));
            const increment = target / 100; // Tốc độ animation (càng nhỏ càng chậm)
            let current = 0;
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                el.textContent = Math.floor(current).toLocaleString();
            }, 20); // Tốc độ update (ms)
        });
    }

    // Chạy animation khi trang load
    window.addEventListener('load', animateNumbers);

    // Biểu đồ cột với animation mặc định của Chart.js
new Chart(document.getElementById('barChart'), {
    type: 'bar',
    data: {
        labels: ['Tài khoản', 'Sinh viên', 'Đợt lao động', 'Hoàn thành'],
        datasets: [{
            label: 'Số lượng',
            data: [
                @Model.TongTaiKhoan,
                @Model.TongSinhVien,
                @Model.TongDotLaoDong,
                @Model.TongHoanThanh
            ],
            backgroundColor: [
                '#007bff', // Tài khoản - xanh dương
                '#28a745', // Sinh viên - xanh lá
                '#ffc107', // Đợt lao động - vàng
                '#17a2b8'  // Hoàn thành - xanh ngọc
            ],
            borderColor: [
                '#0056b3',
                '#1e7e34',
                '#d39e00',
                '#117a8b'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        animation: {
            duration: 2000,
            easing: 'easeInOutQuart'
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    callback: function(value) {
                        return value.toLocaleString();
                    }
                }
            }
        },
        plugins: {
            legend: { display: false } // Ẩn chú thích nếu không cần
        }
    }
});


    // CSS animation cho card (fade in và scale nhẹ) và chart container
    const style = document.createElement('style');
    style.textContent = `
        .animate-card {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease-out;
        }
        .animate-card.animate {
            opacity: 1;
            transform: translateY(0);
        }
        .chart-container {
            position: relative;
            height: 200px; /* Chiều cao nhỏ hơn để biểu đồ nhỏ lại */
            margin: 0 auto;
            width: 100%;
        }
    `;
    document.head.appendChild(style);

    // Trigger animation cho card khi load
    setTimeout(() => {
        document.querySelectorAll('.animate-card').forEach(card => {
            card.classList.add('animate');
        });
    }, 500);
</script>