@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <title> Trang Quản Trị</title>

    <!-- Font + Bootstrap + Icon -->
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/Huynhtienhieu1234/UploadAnh/logoxoanen.png" />





    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="~/Areas/Content/admin.css" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/Areas/Content/Js/adminCommon.js"></script>
    <style>
        nav.navbar.navbar-main.navbar-expand-lg.px-0.mx-4.shadow-none.border-radius-xl.my-3 {
            margin-left: 0 !important;
            margin-right: 0 !important;
        }

        /* ====== STYLE TOAST HIỆN ĐẠI ====== */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
        }

        .toast {
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            font-weight: 500;
            margin-bottom: 15px;
            overflow: hidden;
            border: none;
            min-width: 320px;
            position: relative;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            opacity: 0;
            transform: translateX(400px) scale(0.8);
        }

            .toast.show {
                opacity: 1;
                transform: translateX(0) scale(1);
            }

            .toast.hiding {
                opacity: 0;
                transform: translateX(400px) scale(0.8);
            }

            .toast:hover {
                transform: translateY(-3px) scale(1.02);
                box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
            }

        /* Màu sắc cho các loại thông báo */
        .toast-success {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }

        .toast-warning {
            background: linear-gradient(135deg, #ff9800, #e68900);
        }

        .toast-error {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        .toast-info {
            background: linear-gradient(135deg, #2196F3, #0b7dda);
        }

        .toast-body {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            color: white;
        }

        .toast-icon {
            font-size: 1.5rem;
            margin-right: 12px;
            width: 30px;
            text-align: center;
        }

        .toast-content {
            flex: 1;
            font-size: 14px;
            line-height: 1.4;
        }

        .toast-close {
            background: none;
            border: none;
            color: white;
            opacity: 0.8;
            cursor: pointer;
            padding: 5px;
            margin-left: 10px;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

            .toast-close:hover {
                background: rgba(255, 255, 255, 0.2);
                opacity: 1;
                transform: rotate(90deg);
            }

        /* Thanh tiến trình với transition */
        .toast-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px;
            background: rgba(255, 255, 255, 0.7);
            width: 100%;
            transform-origin: left;
            transition: transform 3s linear;
        }

            .toast-progress.running {
                transform: scaleX(0);
            }

        /* ====== ANIMATION GBA STYLE CHO NÚT DANH SÁCH XÓA ====== */
        .gba-deleted-btn {
            background: linear-gradient(135deg, #8bac0f 0%, #9bbc0f 100%) !important;
            border: 2px solid #306230 !important;
            color: #0f380f !important;
            font-weight: bold;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            animation: gbaGlow 2s infinite alternate;
            border-radius: 8px !important;
            padding: 6px 12px !important;
        }

            .gba-deleted-btn::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
                transition: left 0.5s ease;
            }

            .gba-deleted-btn:hover::before {
                left: 100%;
            }

            .gba-deleted-btn:hover {
                animation: gbaPulse 0.6s ease, gbaGlow 1s infinite alternate;
                transform: translateY(-2px);
                box-shadow: 0 6px 12px rgba(15, 56, 15, 0.4);
                border-color: #0f380f !important;
            }

            .gba-deleted-btn:active {
                animation: gbaPress 0.2s ease;
                transform: translateY(1px);
            }

                /* Hiệu ứng pixelated click */
                .gba-deleted-btn:active::after {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(15, 56, 15, 0.3);
                    animation: pixelFlash 0.3s ease;
                }

        /* Animation glow GBA */
        @@keyframes gbaGlow {
            0% {
                box-shadow: 0 4px 8px rgba(139, 172, 15, 0.3);
            }

            100% {
                box-shadow: 0 4px 16px rgba(139, 172, 15, 0.6), 0 0 8px rgba(155, 188, 15, 0.4);
            }
        }

        /* Animation pulse khi hover */
        @@keyframes gbaPulse {
            0% {
                transform: scale(1) translateY(0);
            }

            50% {
                transform: scale(1.05) translateY(-3px);
            }

            100% {
                transform: scale(1) translateY(-2px);
            }
        }

        /* Animation khi nhấn */
        @@keyframes gbaPress {
            0% {
                transform: scale(1) translateY(-2px);
            }

            50% {
                transform: scale(0.95) translateY(0);
            }

            100% {
                transform: scale(1) translateY(1px);
            }
        }

        /* Hiệu ứng flash pixel */
        @@keyframes pixelFlash {
            0% {
                opacity: 0.5;
            }

            100% {
                opacity: 0;
            }
        }

        /* Hiệu ứng scanline (giống màn hình GBA) */
        .gba-deleted-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            animation: scanline 3s linear infinite;
            opacity: 0;
        }

        .gba-deleted-btn:hover::after {
            opacity: 1;
        }

        @@keyframes scanline {
            0% {
                transform: translateY(-100%);
            }

            100% {
                transform: translateY(400%);
            }
        }

        /* ====== STYLE CHO MODAL ĐĂNG XUẤT ====== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease;
        }

        .boder_delete {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border-radius: 12px;
            width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: slideDown 0.3s ease;
            height: 181px;
        }

        .modal-text {
            text-align: center;
            padding: 20px;
        }

            .modal-text p {
                font-size: 18px;
                margin-bottom: 25px;
                color: #333;
                font-weight: 500;
            }

        .boder_two_buton {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .btn-xoa {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 100px;
        }

            .btn-xoa:hover {
                background: linear-gradient(135deg, #c82333, #bd2130);
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
            }

        .btn-huy {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 100px;
        }

            .btn-huy:hover {
                background: linear-gradient(135deg, #5a6268, #545b62);
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(108, 117, 125, 0.4);
            }

        /* Nút đăng xuất chính */
        .timkiem {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

            .timkiem:hover {
                background: linear-gradient(135deg, #c82333, #bd2130);
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
            }

            .timkiem:active {
                transform: translateY(0);
            }

        /* Animation cho modal */
        @@keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @@keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* ====== OVERLAY LOADING ĐĂNG XUẤT ====== */
        .logout-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

            .logout-overlay.active {
                opacity: 1;
                visibility: visible;
            }

        .logout-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            transform: scale(0.7);
            transition: transform 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .logout-overlay.active .logout-card {
            transform: scale(1);
        }

        .logout-icon {
            font-size: 64px;
            color: #dc3545;
            margin-bottom: 20px;
            animation: bounce 0.6s ease;
        }

        .logout-text {
            font-size: 18px;
            color: #333;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .logout-countdown {
            font-size: 14px;
            color: #666;
            margin-top: 15px;
        }

        .countdown-number {
            font-weight: bold;
            color: #dc3545;
        }

        .logout-progress-bar {
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            margin-top: 15px;
            overflow: hidden;
        }

        .logout-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc3545, #c82333);
            width: 0%;
            transition: width 2s linear;
        }

        .logout-overlay.active .logout-progress-fill {
            width: 100%;
        }

        @@keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }

            40% {
                transform: translateY(-10px);
            }

            60% {
                transform: translateY(-5px);
            }
        }
    </style>
</head>

@RenderSection("Scripts", required: false)

<body>
    <!-- Overlay loading đăng xuất -->
    <div class="logout-overlay" id="logoutOverlay">
        <div class="logout-card">
            <div class="logout-icon">
                <i class="fas fa-sign-out-alt"></i>
            </div>
            <div class="logout-text">Đang đăng xuất...</div>
            <p class="logout-countdown">Chuyển hướng sau <span class="countdown-number" id="logoutCountdown">3</span> giây</p>
            <div class="logout-progress-bar">
                <div class="logout-progress-fill" id="logoutProgressFill"></div>
            </div>
        </div>
    </div>

    <div class="d-flex">
        <!-- Sidebar -->
        <aside class="shadow m-4 rounded-5 pb-4" style="width: 290px; min-height: 95vh;">
            <div class="p-3">
                <a class="navbar-brand d-flex align-items-center" href="#">
                    <span class="ms-2 fw-bold grayColor">👋 XIN CHÀO, ADMIN</span>
                </a>
            </div>
            <hr class="hr">

            <ul class="nav flex-column">
                <li class="nav-item">
                    <a href="@Url.Action("Index","Admin",new{area="Admin"})" class="nav-link">
                        <i class="fas fa-home me-1"></i>Trang Chủ
                    </a>
                </li>
                <li class="nav-item"><a href="@Url.Action("Index","Account",new{area="Admin"})" class="nav-link"><i class="fa fa-list-alt"></i>Tài Khoản</a></li>
                <li class="nav-item"><a href="@Url.Action("Index","AdminWordRegister",new{area="Admin"})" class="nav-link"><i class="fa fa-calendar-plus"></i>Tạo Đợt LĐ</a></li>
                <li class="nav-item"><a href="@Url.Action("DuyetLaoDong","AdminTask",new{area="Admin"})" class="nav-link"><i class="fa fa-check-square"></i>Duyệt Lao Động</a></li>
                <li class="nav-item"><a href="@Url.Action("XacNhanHoanThanh","XacNhanHoanThanhLD",new{area="Admin"})" class="nav-link"><i class="fa fa-clipboard-check"></i>Xác Nhận Hoàn Thành</a></li>
                <li class="nav-item"><a href="@Url.Action("TrangChuSinhVien","QuanLySinhVien",new{area="Admin"})" class="nav-link"><i class="fa fa-users"></i>Danh Sách SV</a></li>
                <li class="nav-item"><a href="@Url.Action("ThongKeIndex","ThongKe",new{area="Admin"})" class="nav-link"><i class="fa fa-chart-bar"></i>Thống Kê</a></li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content flex-grow-1 position-relative border-radius-lg" style="width: calc(100% - 280px);">
            <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl my-3">
                <div class="container-fluid py-1 px-3">
                    <a href="@Url.Action("Index","Admin",new{area="Admin"})">
                        <img src="https://cdn.jsdelivr.net/gh/Huynhtienhieu1234/UploadAnh@main/admin/Logodaxoanen.png" alt="Logo" class="logo">
                    </a>

                    <div class="collapse navbar-collapse" id="navbar">
                        <div class="ms-md-auto pe-md-3 d-flex align-items-center">
                            <button class="timkiem" onclick="openModal()">
                                <i class="fa fa-sign-out"></i> Đăng xuất
                            </button>

                            <!-- Modal xác nhận đăng xuất -->
                            <div id="confirmationModal" class="modal">
                                <div class="boder_delete">
                                    <div class="modal-text">
                                        <p>Bạn có chắc chắn muốn đăng xuất?</p>
                                        <div class="boder_two_buton">
                                            <button class="btn-xoa" onclick="confirmLogout()">Có</button>
                                            <button class="btn-huy" onclick="closeModal()">Hủy</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>

            <div class="container-fluid">
                @RenderBody()
            </div>
        </main>
    </div>

    <!-- BONG BÓNG THÔNG BÁO DÙNG CHUNG -->
    <div id="toastContainer" class="toast-container"></div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {

            // ===== XỬ LÝ MODAL ĐĂNG XUẤT =====
            window.openModal = function () {
                document.getElementById('confirmationModal').style.display = 'flex';
            }

            window.closeModal = function () {
                document.getElementById('confirmationModal').style.display = 'none';
            }

            // ===== XỬ LÝ ĐĂNG XUẤT =====
            window.confirmLogout = function () {
                // Đóng modal xác nhận
                closeModal();

                // Hiển thị overlay loading
                showLogoutOverlay();
            }

            // ===== HIỆU ỨNG LOADING ĐĂNG XUẤT =====
            function showLogoutOverlay() {
                const overlay = document.getElementById('logoutOverlay');
                const countdownElement = document.getElementById('logoutCountdown');
                const progressFill = document.getElementById('logoutProgressFill');

                // Hiển thị overlay
                overlay.classList.add('active');

                let countdown = 3;
                countdownElement.textContent = countdown;

                // Cập nhật countdown mỗi giây
                const countdownInterval = setInterval(() => {
                    countdown--;
                    countdownElement.textContent = countdown;

                    if (countdown <= 0) {
                        clearInterval(countdownInterval);
                        // Chuyển hướng đến trang login
                        window.location.href = '@Url.Action("Login", "Login", new { area = "" })';
                    }
                }, 1000);
            }

            // ===== HIGHLIGHT MENU =====
            const navLinks = document.querySelectorAll(".nav-link");
            const sidebar = document.querySelector("aside");
            const highlight = document.createElement("div");
            highlight.classList.add("sidebar-highlight");
            sidebar.appendChild(highlight);

            const currentPath = window.location.pathname.toLowerCase();
            let currentActive = null;

            navLinks.forEach(link => {
                const linkPath = new URL(link.href).pathname.toLowerCase();
                if (currentPath === linkPath) {
                    link.classList.add("active");
                    currentActive = link;
                }
            });

            if (!currentActive) {
                navLinks.forEach(link => {
                    const linkPath = new URL(link.href).pathname.toLowerCase();
                    if (currentPath.includes(linkPath)) {
                        link.classList.add("active");
                        currentActive = link;
                    }
                });
            }

            function moveHighlight(activeLink) {
                if (!activeLink) return;
                const rect = activeLink.getBoundingClientRect();
                highlight.style.top = (activeLink.offsetTop + 6) + "px";
                highlight.style.height = rect.height + "px";
            }

            moveHighlight(currentActive);

            // ===== HIỆU ỨNG GBA CHO NÚT DANH SÁCH XÓA =====
            const deletedListBtn = document.getElementById('btnDeletedList');
            if (deletedListBtn) {
                deletedListBtn.addEventListener('click', function() {
                    // Thêm hiệu ứng visual feedback
                    this.style.animation = 'gbaPress 0.3s ease';
                    setTimeout(() => {
                        this.style.animation = 'gbaGlow 2s infinite alternate';
                    }, 300);
                });
            }

            // ===== PHÂN TRANG (nếu có bảng dữ liệu) =====
            const body = document.querySelector("#accountTableBody");
            if (body) {
                const totalItems = body.querySelectorAll("tr").length;
                const itemsPerPage = 5;
                let currentPage = 1;
                const totalPages = Math.ceil(totalItems / itemsPerPage);

                function renderTable() {
                    const rows = body.querySelectorAll("tr");
                    rows.forEach((row, index) => {
                        row.style.display = (index >= (currentPage - 1) * itemsPerPage && index < currentPage * itemsPerPage) ? "" : "none";
                    });
                }

                function renderPagination() {
                    const pageNumbers = document.getElementById("pageNumbers");
                    if (!pageNumbers) return;
                    pageNumbers.innerHTML = "";

                    for (let i = 1; i <= totalPages; i++) {
                        const btn = document.createElement("button");
                        btn.textContent = i;
                        btn.className = "btn btn-sm " + (i === currentPage ? "btn-primary active" : "btn-outline-secondary");
                        btn.addEventListener("click", () => {
                            currentPage = i;
                            updateDisplay();
                        });
                        pageNumbers.appendChild(btn);
                    }

                    const pageInfo = document.getElementById("pageInfo");
                    if (pageInfo)
                        pageInfo.textContent = `Trang ${currentPage} / ${totalPages}`;
                }

                function updateDisplay() {
                    renderTable();
                    renderPagination();
                }

                const prev = document.getElementById("prev");
                const next = document.getElementById("next");

                if (prev) prev.addEventListener("click", () => {
                    if (currentPage > 1) {
                        currentPage--;
                        updateDisplay();
                    }
                });

                if (next) next.addEventListener("click", () => {
                    if (currentPage < totalPages) {
                        currentPage++;
                        updateDisplay();
                    }
                });

                updateDisplay();
            }

            // ===== HIỂN THỊ TOAST TỰ ĐỘNG NẾU CÓ TEMP DATA =====
            const msg = '@TempData["Message"]';
            const type = '@TempData["MessageType"]';
            if (msg && msg.trim() !== "") {
                showToast(msg, type || "success");
            }
        });

        // ===== HÀM HIỂN THỊ BONG BÓNG THÔNG BÁO HIỆN ĐẠI =====
        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toastContainer');

            // Tạo toast element
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;

            // Xác định icon theo loại thông báo
            let icon = 'fa-check-circle';
            switch(type) {
                case 'warning':
                    icon = 'fa-exclamation-triangle';
                    break;
                case 'error':
                    icon = 'fa-times-circle';
                    break;
                case 'info':
                    icon = 'fa-info-circle';
                    break;
                default:
                    icon = 'fa-check-circle';
            }

            // Tạo nội dung toast
            toast.innerHTML = `
                <div class="toast-body">
                    <div class="toast-icon">
                        <i class="fas ${icon}"></i>
                    </div>
                    <div class="toast-content">
                        ${message}
                    </div>
                    <button type="button" class="toast-close" onclick="removeToast(this)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="toast-progress"></div>
            `;

            // Thêm toast vào container
            toastContainer.appendChild(toast);

            // Hiệu ứng xuất hiện
            setTimeout(() => {
                toast.classList.add('show');

                // Bắt đầu thanh tiến trình
                const progress = toast.querySelector('.toast-progress');
                setTimeout(() => {
                    progress.classList.add('running');
                }, 50);
            }, 10);

            // Tự động xóa toast sau 3 giây
            setTimeout(() => {
                removeToastElement(toast);
            }, 3000);
        }

        // Hàm xóa toast khi click nút đóng
        function removeToast(button) {
            const toast = button.closest('.toast');
            removeToastElement(toast);
        }

        // Hàm xóa toast với hiệu ứng
        function removeToastElement(toast) {
            if (!toast || toast.classList.contains('hiding')) return;

            toast.classList.remove('show');
            toast.classList.add('hiding');

            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 500);
        }

        // ===== XỬ LÝ CLICK NGOÀI MODAL ĐỂ ĐÓNG =====
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('confirmationModal');
            if (event.target === modal) {
                closeModal();
            }
        });

        // ===== XỬ LÝ PHÍM ESC ĐỂ ĐÓNG MODAL =====
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>