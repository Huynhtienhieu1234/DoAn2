@model QuanLyDangKyNgayLD.Models.SinhVien

@{
    ViewBag.Title = "Thông tin sinh viên";
    Layout = "~/Areas/Student/Views/Shared/Viewsiderbar.cshtml";
}

<div class="container mt-4">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Thông tin sinh viên</h4>
        </div>
        <div class="card-body">
            @using (Html.BeginForm("UpdateInfo", "MainSinhVien", FormMethod.Post, new { area = "Student", enctype = "multipart/form-data" }))
            {
                @Html.AntiForgeryToken()

                <!-- Hiển thị avatar hiện tại -->
                <div class="text-center mb-4">
                    <img id="avatarPreview"
                         src="@(Model.Anh != null ? Url.Content(Model.Anh.DuongDan) : Url.Content("~/image/Avarta.png"))"
                         class="rounded-circle"
                         alt="Avatar"
                         style="width:120px;height:120px;object-fit:cover;" />
                </div>

                <!-- Upload ảnh mới -->
                <div class="mb-3">
                    <label class="form-label">Ảnh đại diện</label>
                    <input type="file" name="AvatarFile" id="avatarFile" class="form-control" accept="image/*" />
                </div>

                <!-- Thông tin cá nhân -->
                <h5 class="text-primary mb-3">Thông tin cá nhân</h5>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">MSSV</label>
                        @Html.TextBoxFor(m => m.MSSV, new { @class = "form-control", placeholder = "Nhập MSSV", @readonly = "readonly" })
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Họ và Tên</label>
                        @Html.TextBoxFor(m => m.HoTen, new { @class = "form-control", placeholder = "Nhập họ tên", @readonly = "readonly" })
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Email*</label>
                        @Html.TextBoxFor(m => m.Email, new { @class = "form-control", placeholder = "Nhập email" })
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Số điện thoại*</label>
                        @Html.TextBoxFor(m => m.SoDienThoaiSinhVien, new { @class = "form-control", placeholder = "Nhập số điện thoại" })
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Ngày sinh*</label>
                        @Html.TextBoxFor(m => m.NgaySinh, "{0:yyyy-MM-dd}", new { @class = "form-control", type = "date" })
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Giới tính</label>
                        @Html.TextBoxFor(m => m.GioiTinh, new { @class = "form-control", @readonly = "readonly" })
                    </div>

                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Quê quán*</label>
                        @Html.TextBoxFor(m => m.QueQuan, new { @class = "form-control", placeholder = "Nhập quê quán" })
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Khoa</label>
                        @Html.TextBoxFor(m => m.Lop.Khoa.TenKhoa, new
                        {
                            @class = "form-control",
                            placeholder = "Khoa",
                            @readonly = "readonly"
                        })
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Lớp</label>
                        @Html.TextBoxFor(m => m.Lop.TenLop, new
                        {
                            @class = "form-control",
                            placeholder = "Lớp",
                            @readonly = "readonly"
                        })
                    </div>

                </div>


                <!-- Thông tin tài khoản -->
                <h5 class="text-primary mt-4 mb-3">Thông tin tài khoản</h5>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Tên tài khoản</label>
                        @Html.TextBoxFor(m => m.TaiKhoan1.Username, new { @class = "form-control", placeholder = "Tên đăng nhập", @readonly = "readonly" })
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Vai trò</label>
                        @Html.TextBoxFor(m => m.TaiKhoan1.VaiTro.TenVaiTro, new { @class = "form-control", placeholder = "Vai trò", @readonly = "readonly" })
                    </div>
                </div>


                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Mật khẩu mới*</label>
                        <div class="input-group">
                            <input type="password" name="MatKhauMoi" id="matkhau" class="form-control" placeholder="Nhập mật khẩu mới" />
                            <span class="input-group-text" id="togglePassword" style="cursor: pointer;">
                                <i class="fa fa-eye" id="eyeIcon"></i>
                            </span>
                        </div>
                    </div>
                </div>
                <script>
                    document.getElementById("togglePassword").addEventListener("click", function () {
                        const input = document.getElementById("matkhau");
                        const icon = document.getElementById("eyeIcon");

                        if (input.type === "password") {
                            input.type = "text";
                            icon.classList.remove("fa-eye");
                            icon.classList.add("fa-eye-slash");
                        } else {
                            input.type = "password";
                            icon.classList.remove("fa-eye-slash");
                            icon.classList.add("fa-eye");
                        }
                    });
                </script>





                <!-- Nút hành động -->
                <div class="d-flex justify-content-between">
                    <a href="@Url.Action("Index","MainSinhVien", new { area="Student" })" class="btn btn-secondary">
                        Quay lại
                    </a>
                    <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
                </div>
            }
        </div>
    </div>
</div>


<script>
    // Preview ảnh khi chọn file
    document.getElementById("avatarFile").addEventListener("change", function (event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = e => {
                document.getElementById("avatarPreview").src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    });
</script>
<script src="~/Areas/Student/Content/Js/StudentMain/StudentInfo.js"></script>
